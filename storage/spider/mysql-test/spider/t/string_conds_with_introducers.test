--echo #
--echo # Test SELECT with string conditions that contain introducers.
--echo #

--disable_warnings
--disable_query_log
--source ../t/test_init.inc
--disable_result_log
--enable_result_log
--enable_query_log

--let $USE_CHILD_GROUP2_BACKUP= $USE_CHILD_GROUP2
--let $USE_CHILD_GROUP2= 1
--let $USE_GENERAL_LOG_BACKUP= $USE_GENERAL_LOG
--let $USE_GENERAL_LOG= 1

--source ../include/spider_create_database.inc
--let $TABLE_NAME = t1
--let $TABLE_BODY = id int, b binary(16), vc varchar(32), primary key(id)
--echo $TABLE_BODY
--let $TABLE_SHARD_KEY = id
--source ../include/spider_create_table_helper.inc

--connection master_1
SET @old_cs_client = @@character_set_client;
SET @old_cs_conn = @@character_set_connection;
SET character_set_client = utf8;
SET character_set_connection = utf8;

INSERT INTO t1 VALUES (1,'±½èzˆY#‡L·´l^áÛ',NULL);
INSERT INTO t1 VALUES (2,NULL,"ä½ å¥½");

SELECT id, HEX(b), HEX(vc) FROM t1;

if ($USE_GENERAL_LOG)
{
    SET @old_log_output = @@global.log_output;
    SET @old_general_log = @@global.general_log;
    SET @old_spider_general_log = @@global.spider_general_log;
    SET GLOBAL log_output = 'TABLE';
    SET GLOBAL general_log = 1;
    SET GLOBAL spider_general_log = 1;
    TRUNCATE TABLE mysql.general_log;
}

SELECT id, HEX(b) FROM t1 WHERE b = '±½èzˆY#‡L·´l^áÛ';
if ($USE_GENERAL_LOG)
{
    SELECT argument FROM mysql.general_log WHERE argument LIKE '%select%' AND argument NOT LIKE '%argument%';
    TRUNCATE TABLE mysql.general_log;
}

SELECT id, HEX(b) FROM t1 WHERE b = _binary'±½èzˆY#‡L·´l^áÛ';
if ($USE_GENERAL_LOG)
{
    SELECT argument FROM mysql.general_log WHERE argument LIKE '%select%' AND argument NOT LIKE '%argument%';
    TRUNCATE TABLE mysql.general_log;
}

SELECT id, HEX(vc) FROM t1 WHERE vc = "ä½ å¥½";
if ($USE_GENERAL_LOG)
{
    SELECT argument FROM mysql.general_log WHERE argument LIKE '%select%' AND argument NOT LIKE '%argument%';
    TRUNCATE TABLE mysql.general_log;
}

SELECT id, HEX(vc) FROM t1 WHERE vc = _utf8"ä½ å¥½";
if ($USE_GENERAL_LOG)
{
    SELECT argument FROM mysql.general_log WHERE argument LIKE '%select%' AND argument NOT LIKE '%argument%';
    TRUNCATE TABLE mysql.general_log;
}

# SELECT id, HEX(vc) FROM t1 WHERE vc = _gbk"ï¿½ï¿½ï¿½";
SELECT id, HEX(vc) FROM t1 WHERE vc = _binary"ä½ å¥½";
if ($USE_GENERAL_LOG)
{
    SELECT argument FROM mysql.general_log WHERE argument LIKE '%select%' AND argument NOT LIKE '%argument%';
    TRUNCATE TABLE mysql.general_log;
}

# cleanup
SET character_set_client = @old_cs_client;
SET character_set_connection = @old_cs_conn;
if ($USE_GENERAL_LOG)
{
    --connection master_1
    SET GLOBAL log_output = @old_log_output;
    SET GLOBAL general_log = @old_general_log;
    SET GLOBAL spider_general_log = @old_spider_general_log;
    TRUNCATE TABLE mysql.general_log;
}

--let @USE_CHILD_GROUP2= $USE_CHILD_GROUP2_BACKUP
--let @USE_GENERAL_LOG= $USE_GENERAL_LOG_BACKUP

--source ../include/spider_drop_database.inc
