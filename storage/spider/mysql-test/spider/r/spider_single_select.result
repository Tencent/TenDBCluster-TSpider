for master_1
for child2
child2_1
child2_2
child2_3
for child3
child3_1
child3_2
child3_3

drop and create databases
connection master_1;
DROP DATABASE IF EXISTS auto_test_local;
CREATE DATABASE auto_test_local;
USE auto_test_local;
connection child2_1;
DROP DATABASE IF EXISTS auto_test_remote;
CREATE DATABASE auto_test_remote;
USE auto_test_remote;
connection child2_2;
DROP DATABASE IF EXISTS auto_test_remote_2;
CREATE DATABASE auto_test_remote_2;
USE auto_test_remote_2;

create table for child
connection child2_1;
CHILD2_1_DROP_TABLES
CHILD2_1_CREATE_TABLES
connection child2_2;
CHILD2_2_DROP_TABLES
CHILD2_2_CREATE_TABLES

create table for master
connection master_1;
DROP TABLE IF EXISTS tbl;
CREATE TABLE tbl (
id int primary key,
pad char(60),
c char(120),
flag int,
ckey int,
index idx(ckey)
)ENGINE=Spider DEFAULT CHARSET=utf8
PARTITION BY LIST (id % 2)
(
PARTITION `pt0` VALUES IN (0) COMMENT = 'database "auto_test_remote", table "tbl", srv "s_2_1",aim "0"',
PARTITION `pt1` VALUES IN (1) COMMENT = 'database "auto_test_remote_2", table "tbl", srv "s_2_2",aim "1"'
);

insert data and test
INSERT INTO tbl VALUES
(1,  "67847967377-48000963322-62604785301-91415491898-96926520291", "83868641912-28773972837-60736120486-75162659906-27563526494-20381887404-41576422241-93426793964-56405065102-33518432330", 1, 10),
(2,  "23183251411-36241541236-31706421314-92007079971-60663066966", "38014276128-25250245652-62722561801-27818678124-24890218270-18312424692-92565570600-36243745486-21199862476-38576014630", 1, 9),
(3,  "38615512647-91458489257-90681424432-95014675832-60408598704", "33973744704-80540844748-72700647445-87330233173-87249600839-07301471459-22846777364-58808996678-64607045326-48799346817", 0, 8),
(4,  "63947013338-98809887124-59806726763-79831528812-45582457048", "37002370280-58842166667-00026392672-77506866252-09658311935-56926959306-83464667271-94685475868-28264244556-14550208498", 1, 7),
(5,  "34551750492-67990399350-81179284955-79299808058-21257255869", "44257470806-17967007152-32809666989-26174672567-29883439075-95767161284-94957565003-35708767253-53935174705-16168070783", 0, 6),
(6,  "05161542529-00085727016-35134775864-52531204064-98744439797", "37216201353-39109531021-11197415756-87798784755-02463049870-83329763120-57551308766-61100580113-80090253566-30971527105", 0, 5),
(7,  "91798303270-64988107984-08161247972-12116454627-22996445111", "33071042495-29920376648-91343430102-79082003121-73317691963-02846712788-88069761578-14885283975-44409837760-90760298045", 0, 4),
(8,  "76460662325-41613089656-42706083314-81833284991-17063140920", "73754818686-04889373966-18668178968-56957589012-31352882173-91882653509-59577900152-88962682169-52981807259-62646890059", 1, 3),
(9,  "30508501104-50823269125-88107014550-70202920684-95842308929", "26482547570-00155460224-12388481921-23289186371-78242522654-77998886134-73270876420-50821093220-31442690639-11588920653", 0, 2),
(10, "62779785163-72948938250-41369758259-80996497836-62655463951", "80707408529-50567701755-94710751896-99750913740-12893433455-71449705205-06190682370-44407762850-72484044178-50518730145", 1, 1),
(11, "48573666000-08738799548-77636362790-42210907101-93959032950", "36136545002-86991679216-03626334357-76004089615-79374967509-18534984815-05132458464-89989437682-83510632788-12432287646", 0, null);
SET @single_select_index_bk = @@spider_ignore_single_select_index;
spider_ignore_single_select_index enable
set spider_ignore_single_select_index = ON;
JOIN TYPE 'const' TEST
SELECT pad FROM tbl WHERE id = 5;
pad
34551750492-67990399350-81179284955-79299808058-21257255869
EXPLAIN SELECT pad FROM tbl WHERE id = 5;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	const	PRIMARY	PRIMARY	4	const	1	
SELECT * FROM tbl WHERE id = 9;
id	pad	c	flag	ckey
9	30508501104-50823269125-88107014550-70202920684-95842308929	26482547570-00155460224-12388481921-23289186371-78242522654-77998886134-73270876420-50821093220-31442690639-11588920653	0	2
EXPLAIN SELECT * FROM tbl WHERE id = 9;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	const	PRIMARY	PRIMARY	4	const	1	
SELECT c FROM tbl WHERE id = 3;
c
33973744704-80540844748-72700647445-87330233173-87249600839-07301471459-22846777364-58808996678-64607045326-48799346817
EXPLAIN SELECT c FROM tbl WHERE id = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	const	PRIMARY	PRIMARY	4	const	1	
JOIN TYPE 'ref' TEST
SELECT pad FROM tbl WHERE ckey = 2;
pad
30508501104-50823269125-88107014550-70202920684-95842308929
EXPLAIN SELECT pad FROM tbl WHERE ckey = 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	ref	idx	idx	5	const	0	
SELECT * FROM tbl WHERE ckey = 7;
id	pad	c	flag	ckey
4	63947013338-98809887124-59806726763-79831528812-45582457048	37002370280-58842166667-00026392672-77506866252-09658311935-56926959306-83464667271-94685475868-28264244556-14550208498	1	7
EXPLAIN SELECT * FROM tbl WHERE ckey = 4;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	ref	idx	idx	5	const	0	
SELECT c FROM tbl WHERE ckey = 8;
c
33973744704-80540844748-72700647445-87330233173-87249600839-07301471459-22846777364-58808996678-64607045326-48799346817
EXPLAIN SELECT c FROM tbl WHERE ckey = 8;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	ref	idx	idx	5	const	0	
JOIN TYPE 'ref_or_null'
SELECT pad FROM tbl WHERE ckey = 7 or ckey is null;
pad
63947013338-98809887124-59806726763-79831528812-45582457048
48573666000-08738799548-77636362790-42210907101-93959032950
EXPLAIN SELECT pad FROM tbl WHERE ckey = 7 or ckey is null;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	ref_or_null	idx	idx	5	const	2	Using where with pushed condition
SELECT * FROM tbl WHERE ckey = 1 or ckey is null;
id	pad	c	flag	ckey
10	62779785163-72948938250-41369758259-80996497836-62655463951	80707408529-50567701755-94710751896-99750913740-12893433455-71449705205-06190682370-44407762850-72484044178-50518730145	1	1
11	48573666000-08738799548-77636362790-42210907101-93959032950	36136545002-86991679216-03626334357-76004089615-79374967509-18534984815-05132458464-89989437682-83510632788-12432287646	0	NULL
EXPLAIN SELECT * FROM tbl WHERE ckey = 1 or ckey is null;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	ref_or_null	idx	idx	5	const	2	Using where with pushed condition
SELECT c FROM tbl WHERE ckey = 10 or ckey is null;
c
83868641912-28773972837-60736120486-75162659906-27563526494-20381887404-41576422241-93426793964-56405065102-33518432330
36136545002-86991679216-03626334357-76004089615-79374967509-18534984815-05132458464-89989437682-83510632788-12432287646
EXPLAIN SELECT c FROM tbl WHERE ckey = 10 or ckey is null;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	ref_or_null	idx	idx	5	const	2	Using where with pushed condition
JOIN TYPE 'index'
SELECT ckey FROM tbl WHERE ckey = 7;
ckey
7
EXPLAIN SELECT ckey FROM tbl WHERE ckey > 7;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	index	idx	idx	5	NULL	4	Using where with pushed condition; Using index
SELECT ckey FROM tbl WHERE ckey < 4;
ckey
1
2
3
EXPLAIN SELECT ckey FROM tbl WHERE ckey < 4;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	index	idx	idx	5	NULL	4	Using where with pushed condition; Using index
SELECT ckey FROM tbl WHERE ckey not in (5);
ckey
1
2
3
4
6
7
8
9
10
EXPLAIN SELECT ckey FROM tbl WHERE ckey not in (5);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	tbl	index	idx	idx	5	NULL	4	Using where with pushed condition; Using index
JOIN TYPE 'range'
Currently, RANGE JOIN TYPE is not tested, since it needs spider_ignore_single_select_index = OFF
spider_ignore_single_select_index restore
set spider_ignore_single_select_index = @single_select_index_bk;

deinit
connection master_1;
DROP DATABASE IF EXISTS auto_test_local;
connection child2_1;
DROP DATABASE IF EXISTS auto_test_remote;
connection child2_2;
DROP DATABASE IF EXISTS auto_test_remote_2;
for master_1
for child2
child2_1
child2_2
child2_3
for child3
child3_1
child3_2
child3_3

end of test
