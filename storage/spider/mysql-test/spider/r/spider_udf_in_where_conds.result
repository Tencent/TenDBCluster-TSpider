for master_1
for child2
child2_1
child2_2
child2_3
for child3
child3_1
child3_2
child3_3

drop and create databases
connection master_1;
DROP DATABASE IF EXISTS auto_test_local;
CREATE DATABASE auto_test_local;
USE auto_test_local;
connection child2_1;
DROP DATABASE IF EXISTS auto_test_remote;
CREATE DATABASE auto_test_remote;
USE auto_test_remote;
connection child2_2;
DROP DATABASE IF EXISTS auto_test_remote_2;
CREATE DATABASE auto_test_remote_2;
USE auto_test_remote_2;

create table for child
connection child2_1;
CHILD2_1_DROP_TABLES
CHILD2_1_CREATE_TABLES
connection child2_2;
CHILD2_2_DROP_TABLES
CHILD2_2_CREATE_TABLES

create table for master
connection master_1;
DROP TABLE IF EXISTS t1;;
CREATE TABLE t1 (id INT PRIMARY KEY, vc varchar(120))ENGINE=Spider DEFAULT CHARSET=utf8 PARTITION BY LIST (CRC32(id) % 2)( PARTITION `pt0` VALUES IN (0) COMMENT = 'database "auto_test_remote", table "t1", srv "s_2_1",aim "0"', PARTITION `pt1` VALUES IN (1) COMMENT = 'database "auto_test_remote_2", table "t1", srv "s_2_2",aim "1"');;
create functions
CREATE FUNCTION `plusone`( param INT ) RETURNS int
BEGIN
RETURN param + 1;
END //
CREATE FUNCTION `addcom`( domain_name TEXT ) RETURNS text CHARSET utf8mb4
BEGIN
RETURN CONCAT(domain_name, ".com");
END //
connection master_1;
USE auto_test_local;
INSERT INTO t1 VALUES (1, "a.com"), (2, "b.com"), (3, "c.com"), (4, "d.com"), (5, "e.com");
SELECT * from t1;
id	vc
4	d.com
5	e.com
1	a.com
2	b.com
3	c.com
##### test SELECTs #####
SELECT * FROM t1 WHERE id = plusone(1);
id	vc
2	b.com
SELECT * FROM t1 WHERE vc = addcom("b");
id	vc
2	b.com
SELECT * FROM t1 WHERE id IN (plusone(1), plusone(2), plusone(3)) AND vc = addcom("c");
id	vc
3	c.com
##### test UPDATEs #####
UPDATE t1 SET vc = addcom("bbbbb") WHERE id = plusone(1);
SELECT * FROM t1;
id	vc
4	d.com
5	e.com
1	a.com
2	bbbbb.com
3	c.com
UPDATE t1 SET vc = addcom("ccccc") WHERE id IN (plusone(1), plusone(2), plusone(3)) AND vc = addcom("c");
SELECT * FROM t1;
id	vc
4	d.com
5	e.com
1	a.com
2	bbbbb.com
3	ccccc.com
##### test DELETEs #####
DELETE FROM t1 WHERE id = plusone(1);
SELECT * FROM t1;
id	vc
4	d.com
5	e.com
1	a.com
3	ccccc.com
DELETE FROM t1 WHERE id IN (plusone(1), plusone(2), plusone(3)) AND vc = addcom("d");
SELECT * FROM t1;
id	vc
5	e.com
1	a.com
3	ccccc.com

deinit
connection master_1;
DROP DATABASE IF EXISTS auto_test_local;
connection child2_1;
DROP DATABASE IF EXISTS auto_test_remote;
connection child2_2;
DROP DATABASE IF EXISTS auto_test_remote_2;
for master_1
for child2
child2_1
child2_2
child2_3
for child3
child3_1
child3_2
child3_3

end of test
